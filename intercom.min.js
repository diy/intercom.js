var Intercom=function(){var g=function(){};g.prototype.on=function(a,c){"undefined"===typeof this.handlers&&(this.handlers={});this.handlers.hasOwnProperty(a)||(this.handlers[a]=[]);this.handlers[a].push(c);for(var b=["event:on"],d=0;d<arguments.length;d++)b.push(arguments[d]);this.trigger.apply(this,b)};g.prototype.off=function(a,c){if("undefined"!==typeof this.handlers&&this.handlers.hasOwnProperty(a))for(var b=this.handlers[a].length-1;0<=b;b--)this.handlers[a][b]===c&&this.handlers[a].splice(b,
1)};g.prototype.trigger=function(a){if("undefined"!==typeof this.handlers&&this.handlers.hasOwnProperty(a))for(var c=Array.prototype.slice.call(arguments,1),b=0;b<this.handlers[a].length;b++)this.handlers[a][b].apply(this.handlers[a][b],c)};var f={};f.isArray=Array.isArray||function(){"[object Array]"===Object.prototype.toString.call(v)};f.clone=function(a){var c;if(f.isArray(a)){c=[];for(var b=0;b<a.length;b++)c.push(a[b])}else if("object"===typeof a)for(b in c={},a)a.hasOwnProperty(b)&&(c[b]=a[b]);
else c=a;return c};var e=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};f.guid=function(){return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()};f.extend=function(a,c){for(var b in c)c.hasOwnProperty(b)&&(a[b]=c[b]);return a};var d=function(){var a=this,c=(new Date).getTime();this.key="intercom";this.origin=f.guid();this.lastCleanup=this.lastMessage=c;window.addEventListener("storage",function(){a._onStorageEvent.apply(a,arguments)})};d.prototype._cleanup=function(){var a=
(new Date).getTime();if(!(50>a-this.lastCleanup)){this.lastCleanup=a;var a=a-1E3,c=JSON.parse(localStorage.getItem(this.key)||"[]");if(c.length){for(var b=0,d=c.length-1;0<=d;d--)c[d].timestamp<a&&(c.splice(d,1),b++);0<b&&localStorage.setItem(this.key,JSON.stringify(c))}}};d.prototype._onStorageEvent=function(a){var c=(new Date).getTime(),a=a&&a.key;if(!a||a===this.key){for(var a=JSON.parse(localStorage.getItem(this.key)||"[]"),b=0;b<a.length;b++)a[b].origin!==this.origin&&!(a[b].timestamp<this.lastMessage)&&
this.trigger(a[b].name,a[b].payload);this.lastMessage=c}this._cleanup()};d.prototype.bind=function(a,c){for(var b=0;b<d.bindings.length;b++)d.bindings[b](a,c||null,this)};d.prototype.emit=function(a,c){var c={name:a,origin:this.origin,timestamp:(new Date).getTime(),payload:c},b=localStorage.getItem(this.key)||"[]",b=[b.substring(0,b.length-1),"[]"===b?"":",",JSON.stringify(c),"]"].join("");localStorage.setItem(this.key,b);this.trigger(c.name,c.payload);this.trigger("intercom:emit",a,c)};f.extend(d.prototype,
g.prototype);d.bindings=[];d.supported="undefined"!==typeof localStorage;d.bindings.push(function(a,c,b){if("undefined"!==typeof a.socket){var d=[],c=function(c){-1===d.indexOf(c)&&!/^(event|intercom):/.test(c)&&(d.push(c),a.on(c,function(a){b.emit(c,a)}))},e;for(e in b.handlers)for(var f=0;f<b.handlers[e].length;f++)c(e,b.handlers[e][f]);b.on("event:on",c);b.on("intercom:emit",function(b,c){a.emit(b,c)})}});return d}();
