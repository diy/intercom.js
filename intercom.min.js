/*! intercom.js | https://github.com/diy/intercom.js | Apache License (v2) */
var Intercom=function(){var h=function(){};h.createInterface=function(b){return{on:function(c,a){"undefined"===typeof this[b]&&(this[b]={});this[b].hasOwnProperty(c)||(this[b][c]=[]);this[b][c].push(a)},off:function(c,a){"undefined"!==typeof this[b]&&this[b].hasOwnProperty(c)&&j.removeItem(a,this[b][c])},trigger:function(c){if("undefined"!==typeof this[b]&&this[b].hasOwnProperty(c))for(var a=Array.prototype.slice.call(arguments,1),e=0;e<this[b][c].length;e++)this[b][c][e].apply(this[b][c][e],a)}}};
var n=h.createInterface("_handlers");h.prototype._on=n.on;h.prototype._off=n.off;h.prototype._trigger=n.trigger;var o=h.createInterface("handlers");h.prototype.on=function(){o.on.apply(this,arguments);Array.prototype.unshift.call(arguments,"on");this._trigger.apply(this,arguments)};h.prototype.off=o.off;h.prototype.trigger=o.trigger;var f=window.localStorage;"undefined"===typeof f&&(f={getItem:function(){},setItem:function(){},removeItem:function(){}});var j={},i=function(){return(65536*(1+Math.random())|
0).toString(16).substring(1)};j.guid=function(){return i()+i()+"-"+i()+"-"+i()+"-"+i()+"-"+i()+i()+i()};j.extend=function(b,c){if("undefined"===typeof b||!b)b={};if("object"===typeof c)for(var a in c)c.hasOwnProperty(a)&&(b[a]=c[a]);return b};j.removeItem=function(b,c){for(var a=c.length-1;0<=a;a--)c[a]===b&&c.splice(a,1);return c};var d=function(){var b=this,c=(new Date).getTime();this.origin=j.guid();this.lastCleanup=this.lastMessage=c;this.bindings=[];this.receivedIDs={};window.addEventListener("storage",
function(){b._onStorageEvent.apply(b,arguments)})};d.prototype._transaction=function(b){var c=this,a=!1,e=!1,p=null,g=function(){if(!a){var d=(new Date).getTime(),r=parseInt(f.getItem(m)||0);r&&1E3>d-r?(e||(c._on("storage",g),e=!0),p=window.setTimeout(g,20)):(a=!0,f.setItem(m,d),b(),e&&c._off("storage",g),p&&window.clearTimeout(p),f.removeItem(m))}};g()};d.prototype._cleanup_emit=function(){this._transaction(function(){for(var b=(new Date).getTime()-5E4,c=0,a=JSON.parse(f.getItem(k)||"[]"),e=a.length-
1;0<=e;e--)a[e].timestamp<b&&(a.splice(e,1),c++);0<c&&f.setItem(k,JSON.stringify(a))})};d.prototype._cleanup_once=function(){this._transaction(function(){var b=(new Date).getTime()-36E5,c=0,a=JSON.parse(f.getItem(l)||"{}"),e;for(e in a)a.hasOwnProperty(e)&&a[e]<b&&(delete a[e],c++);0<c&&f.setItem(l,JSON.stringify(a))})};d.prototype._cleanup=function(){var b=(new Date).getTime();50>b-this.lastCleanup||(this.lastCleanup=b,this._cleanup_emit(),this._cleanup_once())};d.prototype._onStorageEvent=function(b){var c=
b&&b.key,a=this;(!c||c===k)&&this._transaction(function(){for(var c=(new Date).getTime(),b=f.getItem(k),b=JSON.parse(b||"[]"),g=0;g<b.length;g++)if(b[g].origin!==a.origin&&!(b[g].timestamp<a.lastMessage)){if(b[g].id){if(a.receivedIDs.hasOwnProperty(b[g].id))continue;a.receivedIDs[b[g].id]=!0}a.trigger(b[g].name,b[g].payload)}a.lastMessage=c});window.setTimeout(function(){a._cleanup()},50);this._trigger("storage",b)};d.prototype._emit=function(b,c,a){if((a="string"===typeof a||"number"===typeof a?
String(a):null)&&a.length){if(this.receivedIDs.hasOwnProperty(a))return;this.receivedIDs[a]=!0}var e={id:a,name:b,origin:this.origin,timestamp:(new Date).getTime(),payload:c},d=this;this._transaction(function(){var a=f.getItem(k)||"[]",a=[a.substring(0,a.length-1),"[]"===a?"":",",JSON.stringify(e),"]"].join("");f.setItem(k,a);d.trigger(b,c)})};d.prototype.bind=function(b,c){for(var a=0;a<d.bindings.length;a++){var e=d.bindings[a].factory(b,c||null,this);e&&this.bindings.push(e)}};d.prototype.emit=
function(b,c){this._emit.apply(this,arguments);this._trigger("emit",b,c)};d.prototype.once=function(b,c){d.supported&&this._transaction(function(){var a=JSON.parse(f.getItem(l)||"{}");a.hasOwnProperty(b)||(a[b]=(new Date).getTime(),f.setItem(l,JSON.stringify(a)),c())})};j.extend(d.prototype,h.prototype);d.bindings=[];d.supported="undefined"!==typeof f;var k="intercom",l="intercom_once",m="intercom_lock";d.destroy=function(){f.removeItem(m);f.removeItem(k);f.removeItem(l)};var q=function(b,c,a){c=
j.extend({id:null,send:!0,receive:!0},c);if(c.receive){var e=[],d=function(d){-1===e.indexOf(d)&&(e.push(d),b.on(d,function(b){var e="function"===typeof c.id?c.id(d,b):null,f="function"===typeof c.receive?c.receive(d,b):!0;(f||"boolean"!==typeof f)&&a._emit(d,b,e)}))},g;for(g in a.handlers)for(var f=0;f<a.handlers[g].length;f++)d(g,a.handlers[g][f]);a._on("on",d)}c.send&&a._on("emit",function(a,d){var e="function"===typeof c.send?c.send(a,d):!0;(e||"boolean"!==typeof e)&&b.emit(a,d)})};q.factory=
function(b,c,a){return"undefined"===typeof b.socket?!1:new q(b,c,a)};d.bindings.push(q);return d}();
